<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>MTU y Fragmentación</title>
	<link href="../css/style.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
</head>

<body>
	<div id="page">
		<div id="contentwrapper">
			<div id="sidebar_navigation" class="sidebar">
				<div class="left_sidebar_menu">
					<div class="left_sidebar_menu_button">
						<a href="index.html">Inicio</a>
					</div>
					<div class="left_sidebar_menu_selected">
						<a href="documentation.html">Documentación</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="download.html">Descargar</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="faq.html">FAQ</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="https://github.com/NICMx/NAT64/issues" target="_blank">
							Reportar un Bug
						</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="about.html">Acerca de ...</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="contact.html">Contacto</a>
					</div>
				</div>
			</div>
			<div id="content">
				<div class="worklogo">
					<a href="index.html"><img src="../images/jool.png" alt="logo-jool" /></a>
				</div>
				<div class="workarea">
					<div class="content_text">

<p><a href="documentation.html">Documentación</a> &gt; <a href="documentation.html#otros">Otros</a> &gt; MTU y Fragmentación</p>

<h1 id="mtu-y-fragmentacin">MTU y Fragmentación</h1>

<p>TODO - Pendiente hacer revisión</p>

<h2 id="enunciacin-del-problema">Enunciación del problema</h2>

<p>Hay una diferencia principal entre IPv4 e IPv6 la cual un traductor IP no puede compensar.</p>

<p>La cabecera de un paquete IPv4 con tiene un “parámetro” llamado <strong>No Fragmentar</strong> o en inglés <a href="http://en.wikipedia.org/wiki/IPv4#Packet_structure"><em>Don’t fragment</em></a>(DF). Determina si la fuente le permite a los routers fragmentar el paquete.</p>

<p>En IPv6, los paquetes nunca pueden ser fragmentados por los routers. Es como si el parámetro <strong>No Fragmentar</strong> siempre estuviera encendido.</p>

<p>Cuando hay un traductor en el medio, un paquete IPv4 el cual puede ser fragmentado se convierte en un paquete IPv6 que no debe de ser fragmentado.</p>

<p>Asi que, que pasa si el paquete es muy grande?</p>

<p>(Los tamaños actuales de los paquetes son diferentes debido a cambios en los headers, pero entiendes el punto.)</p>

<p><img src="../images/flow/mtu-frag-fail-es.svg" alt="Fig.1 - flujo MTU fallido" /></p>

<p>Esta definido por implementación. Si <em>n4</em> es inteligente, tratará de decrementar la longitud del paquete. Si no, el paquete nunca llegará a <em>n6</em>.</p>

<p>Implementaciones apropiadas de hecho utilizan <a href="http://en.wikipedia.org/wiki/Path_MTU_Discovery">Path MTU discovery</a> y por lo tanto jamas desactivan el parámetro de <strong>No Fragmentar</strong>.</p>

<p>It’s implementation defined. If <em>n4</em> is smart, it will try to decrease the lenght of the packet. If it’s not, the packet will never reach <em>n6</em>.</p>

<p>Proper implementations today actually use <a href="http://en.wikipedia.org/wiki/Path_MTU_Discovery">Path MTU discovery</a> and therefore never unset the DF flag. Still, stubborn or legacy code is not unheard of.</p>

<p>Por cierto: cuando quieras saber el MTU de un link, preguntale a Linux:</p>

<div class="highlight"><pre><code class="bash">$ ip link
(...)
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; <strong>mtu 1500</strong> qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:bf:a6:6e brd ff:ff:ff:ff:ff:ff
</code></pre></div>

<h2 id="solucin">Solución</h2>

<p>Si conoces el MTU más pequeño a lo largo de todas tus redes IPv6, dile a <em>T</em> sobre el:</p>

<p><img src="../images/network/mtu-frag.svg" alt="Fig.2 - Proper Network" /></p>

<p><em>T</em> sabe que está traduciendo, asi que sabe que <strong>tiene</strong> que fragmentar aunque es una especie de router IPv6.</p>

<p>Jool solia tener un parámetro llamado <code>--minMTU6</code> para hacer esto. Ya que confiar la fragmentación al kernel es considerada una mejor práctica, ahora lo configuras en Linux desde la versión de Jool 3.3.</p>

<pre><code>ip link set dev eth0 mtu 1300
</code></pre>

<p>Y voilà:</p>

<p><img src="../images/flow/mtu-frag-success-es.svg" alt="Fig.3 - MTU flow succeeds" /></p>

<p>Si no sabes el MTU mínimo de tus redes IPv6, asigna 1280. Todo nodo IPv6 debe de ser capáz de manejar por lo menos 1280 bytes por paquete de forma estandarizada.</p>



					</div>
				</div>
			</div>
			<div id="language_selector">
				
					<a href="../en/mtu.html">en</a>
				
				|
				
					<span class="selected">es</span>
				
			</div>
			<div style="clear: both;">&nbsp;</div>
		</div>
	</div>

	<div id="footer">
		<div class="logo-tec"><a href="http://www.itesm.mx"><img src="../images/logo-tec.png" alt="logo-tec" /></a></div>
		<div class="logo-nic"><a href="http://www.nicmexico.mx/"><img src="../images/logo-nic.png" alt="logo-nic" /></a></div>
		<p class="legal">&copy;Jool 2015</p>
	</div>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-44741331-2', 'jool.mx');
	  ga('send', 'pageview');

	</script>
</body>
</html>
