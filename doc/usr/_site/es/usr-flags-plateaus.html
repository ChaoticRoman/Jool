<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>--plateaus</title>
	<link href="../css/style.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
</head>

<body>
	<div id="page">
		<div id="contentwrapper">
			<div id="sidebar_navigation" class="sidebar">
				<div class="left_sidebar_menu">
					<div class="left_sidebar_menu_button">
						<a href="index.html">Inicio</a>
					</div>
					<div class="left_sidebar_menu_selected">
						<a href="documentation.html">Documentación</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="download.html">Descargar</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="faq.html">FAQ</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="https://github.com/NICMx/NAT64/issues" target="_blank">
							Reportar un Bug
						</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="about.html">Acerca de ...</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="contact.html">Contacto</a>
					</div>
				</div>
			</div>
			<div id="content">
				<div class="worklogo">
					<a href="index.html"><img src="../images/jool.png" alt="logo-jool" /></a>
				</div>
				<div class="workarea">
					<div class="content_text">

<p><a href="documentation.html">Documentation</a> &gt; <a href="documentation.html#aplicacin-de-espacio-de-usuario">Aplicación de espacio de usuario</a> &gt; <a href="usr-flags.html">Parámetros</a> &gt; <a href="usr-flags-global.html">--global</a> &gt; --plateaus</p>

<h1 id="mtu-plateaus-ejemplo">MTU Plateaus (Ejemplo)</h1>

<h2 id="introduccin">Introducción</h2>

<p>Este articulo explica el propósito del parametro <code>--plateaus</code> mediante un ejemplo.</p>

<p>Esta es la red de ejemplo:</p>

<p><img src="../images/plateaus-network.svg" alt="Fig.1 - Red" /></p>

<p>El número máximo de bytes por paquete (MTU) de los enlaces <em>n6-J</em> y <em>J-r4</em> es 1500.</p>

<p>El enlace <em>r4-n4</em> es una red ARPANET, Por lo tanto, <a href="https://en.wikipedia.org/wiki/BBN_Report_1822">sus paquetes pueden ser de 96-8159 bits de longitud</a> (~1007 bytes).</p>

<p>Aunque las cabeceras de IPv4 son 20 bytes más cortas que las de IPv6 y existen otras peculiaridades; para propósitos de facilitar la comprensión, vamos a establecer que Jool no modificará el tamaño de los paquetes que traduce.</p>

<h2 id="ejemplo">Ejemplo</h2>

<p><em>n6</em> quiere enviar un paquete IPv6 de 1500 bytes a <em>n4</em> (100 bytes de header y 1400 bytes de datos). <em>J</em> lo convierte a un paquete IPv4 de 1500 bytes y lo envía a <em>r4</em>. <em>r4</em> no puede retransmitirlo a <em>n4</em> por que es muy grande para su límite establecido de 1007 bytes, asi que devuelve un error de ICMP a <em>n6</em>.</p>

<p><img src="../images/plateaus-attempt1.svg" alt="Fig.2 - Intento 1" /></p>

<p>La técnica <a href="http://en.wikipedia.org/wiki/Path_MTU_Discovery">Path MTU discovery</a> opera bajo la suposición de que el router que no puede entregar el paquete reportará el tamaño máximo de paquete que puede transmitir. En este punto, el error ICMP contendria el número mágico “1007”, y entonces <em>n6</em> sabría que tiene que segmentar su paquete en las piezas necesarias si es que sigue interesado en la llegada de su mensaje.</p>

<p>Desafortunadamente, la especificación del protocolo de ICMPv4 no ordena la inclusión del número; esto es una idea tardía. Si <em>r4</em> es lo suficientemente antiguo, dejará el campo MTU sin asignar(esto es cero), y <em>n6</em> sería confundido ante la perspectiva de tener que dividir sus datos en grupos de cero bytes. ICMPv6 ordena la inclusión del campo MTU, así que los nodos dependen en ello.</p>

<p>La tarea de encontrar una forma de solucionar esto recae en el NAT64 dado que es el único que tiene comprensión sobre cuál es el problema.</p>

<p><em>J</em> se dará cuenta de que existe un problema por que observará que está tratando de traducir un error ICMPv4 con MTU cero a ICMPv6, donde eso es illegal. <em>J</em> no tiene una forma de saber el MTU de la red <em>r4-n4</em>, así que tiene que adivinar. Sabe que el paquete rechazado fue de 1500 bytes de longitud, asi que revisa el parámetro <code>--plateaus</code>, cuyo valor por omisión está basado en la siguiente tabla <a href="https://tools.ietf.org/html/rfc1191#section-7.1">ver RFC. 1191</a>, y escoge el plateau más cercano inferior que rechazaría un paquete con tamaño de 1500:</p>

<pre><code>   Plateau    MTU    Comments                      Reference
   ------     ---    --------                      ---------
	      65535  Official maximum MTU          RFC 791
	      65535  Hyperchannel                  RFC 1044
   65535
   32000             Just in case
	      17914  16Mb IBM Token Ring
   17914
	      8166   IEEE 802.4                    RFC 1042
   8166
	      4464   IEEE 802.5 (4Mb max)          RFC 1042
	      4352   FDDI (Revised)                RFC 1188
   4352 (1%)
	      2048   Wideband Network              RFC 907
	      2002   IEEE 802.5 (4Mb recommended)  RFC 1042
   2002 (2%)
	      1536   Exp. Ethernet Nets            RFC 895
	      1500   Ethernet Networks             RFC 894
	      1500   Point-to-Point (default)      RFC 1134
	      1492   IEEE 802.3                    RFC 1042
   1492 (3%)
	      1006   SLIP                          RFC 1055
	      1006   ARPANET                       BBN 1822
   1006
	      576    X.25 Networks                 RFC 877
	      544    DEC IP Portal
	      512    NETBIOS                       RFC 1088
	      508    IEEE 802/Source-Rt Bridge     RFC 1042
	      508    ARCNET                        RFC 1051
   508 (13%)
	      296    Point-to-Point (low delay)    RFC 1144
   296
   68                Official minimum MTU          RFC 791
</code></pre>

<p>Asi que <em>J</em> sospecha que la red <em>r4-n4</em> es un paquete con formato IEEE 802.3, y por tanto, traduce el error ICMPv4 con MTU de valor cero a un error ICMPv6 con MTU de valor 1492.</p>

<p><em>n6</em> segmenta su mensaje y ahora envia dos paquetes, uno de 1492 de longitud (100 bytes de cabecera y 1392 de datos), y otro de 108 bytes(100 de cabecera, y 8 de datos). <em>J</em> los traduce, y luego otra vez <em>r4</em> dice “solicitud rechazada”, por que el primer paquete de 1492 bytes sigue sin encajar en una red con un MTU de 1007.</p>

<p><img src="../images/plateaus-attempt2.svg" alt="Fig.3 - Intento 2" /></p>

<p><em>J</em> otra vez se da cuenta de que esta tratando de traducir un error ICMP con MTU 0, asi que otra vez reportar el primer plateau el cual objetaría al paquete rechazado. Esta vez, el siguiente plateau de 1492 is 1006, asi que <em>J</em> supone que <em>r4-n4</em> es un paquete SLIP o ARPANET. Como puedes ver, esta vez la suposición es correcta.</p>

<p>Al recibir la noticia, n6 ahora segmenta sus datos en un paquete de tamaño 1006 (100 + 906) y otro de 594 (100 + 494). Esta vez, los paquetes traducidos de IPv6 cumplen con el requerimiento de longitud establecida por <em>r4</em> y llegan a <em>n4</em>.</p>

<p><img src="../images/plateaus-attempt3.svg" alt="Fig.4 - Intento 3" /></p>

<h2 id="recapitulando">Recapitulando</h2>

<p>La estrategia plateaus es la mejor alternativa existente para efecutar un <strong>Path MTU Discovery</strong>. Por que toma como referencia los MTUs existentes, converge rápido y no permite la fragmentación excesiva del paquete. Para una compresión más profunda sobre el <em>PMTU Discovery</em> <a href="http://tools.ietf.org/html/rfc1191&quot;">vea el RFC 1191</a>.</p>

<p>Por otra parte, mirando el ejemplo podrías haber pensado “ARPANET se disolvió hace mucho tiempo!”, y estarías en lo correcto. Aunque el RFC 1191 dice “los implementadores deben usar referencias actualizadas para escoger un conjunto de plateaus”, nadie ha propuesto algo.</p>

<p>Consideramos que no es tan negativo usar la lista tal cual, dado que algunos de los protocolos de la tabla todavía siguen en uso. Es más precavido, conservar todos los valores  versus a que nos lleguen a faltar.</p>

<p>Cabe mencionar que la lista plateaus NO está codificada directamente en Jool. Si deseas establecer tu propia lista plateaus, ejecuta (después de instalar la <a href="usr-install.html">Herramienta de configuración de Jool</a>.</p>

<pre><code>$(jool) --mtu-plateaus &lt;list&gt;
</code></pre>

<p>Por ejemplo:</p>

<pre><code>jool_siit --mtu-plateaus "80000, 40000, 20000, 10000"
</code></pre>


					</div>
				</div>
			</div>
			<div id="language_selector">
				
					<a href="../en/usr-flags-plateaus.html">en</a>
				
				|
				
					<span class="selected">es</span>
				
			</div>
			<div style="clear: both;">&nbsp;</div>
		</div>
	</div>

	<div id="footer">
		<div class="logo-tec"><a href="http://www.itesm.mx"><img src="../images/logo-tec.png" alt="logo-tec" /></a></div>
		<div class="logo-nic"><a href="http://www.nicmexico.mx/"><img src="../images/logo-nic.png" alt="logo-nic" /></a></div>
		<p class="legal">&copy;Jool 2015</p>
	</div>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-44741331-2', 'jool.mx');
	  ga('send', 'pageview');

	</script>
</body>
</html>
