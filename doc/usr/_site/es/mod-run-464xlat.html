<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>464XLAT</title>
	<link href="../css/style.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
</head>

<body>
	<div id="page">
		<div id="contentwrapper">
			<div id="sidebar_navigation" class="sidebar">
				<div class="left_sidebar_menu">
					<div class="left_sidebar_menu_button">
						<a href="index.html">Inicio</a>
					</div>
					<div class="left_sidebar_menu_selected">
						<a href="documentation.html">Documentación</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="download.html">Descargar</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="faq.html">FAQ</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="https://github.com/NICMx/NAT64/issues" target="_blank">
							Reportar un Bug
						</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="about.html">Acerca de ...</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="contact.html">Contacto</a>
					</div>
				</div>
			</div>
			<div id="content">
				<div class="worklogo">
					<a href="index.html"><img src="../images/jool.png" alt="logo-jool" /></a>
				</div>
				<div class="workarea">
					<div class="content_text">

<p><a href="documentation.html">Documentación</a> &gt; <a href="documentation.html#ejemplos-de-uso">Ejemplos de uso</a> &gt; 464XLAT</p>

<p>TODO - Pendiente hacer revisión</p>

<h1 id="xlat">464XLAT</h1>

<h2 id="ndice">Índice</h2>

<ol>
  <li><a href="#introduccion">Introducción</a></li>
  <li><a href="#red-de-ejemplo">Red de ejemplo</a></li>
  <li><a href="#flujo-de-paquetes-esperado">Flujo de paquetes esperado</a></li>
  <li><a href="#pruebas">Pruebas</a></li>
  <li><a href="#palabras-de-cierre">Palabras de cierre</a></li>
  <li><a href="#lecturas-adicionales">Lecturas adicionales</a></li>
</ol>

<h2 id="introduction">Introduction</h2>

<p>NAT64 no es perfecto. Aunque puedas ver mucho trafico ser tradicido sin capricho alguno, quizá puedas llegar eventualmente al siguiente comportamiento inesperado.</p>

<p>Salvo el RFC 6384, NAT64 solo traduce cabeceras de red (IPv4, IPv6 y ICMP) y cabeceras de transporte (UDP y TCP). Algunas veces, esto es un problema. Algunos protocolos que trabajan encima de UDP y TCP tienen el mal hábito de incluir direcciones IP (“Valores IP literales”) a lo largo de sus conversaciones; ya que NAT64 solo traduce protocolos de mas abajo, estos valores pasaran por el NAT64 sin ser modificados.</p>

<p>Por ejemplo, algunos sitios que no toman en cuenta IPv6, los cuales normalmente contendrian este HTML:</p>

<p><a href="www.jool.mx/index.html">Enlace a algo.</a></p>

<p>Podrian ser pobremente codificados de esta manera:</p>

<p><a href="203.0.113.24/index.html">Enlace a algo.</a></p>

<p>Esta dirección está dentro del cuerpo de un archivo HTML, no de una cabecera de transporte de red. No es viable para Jool soportar la traduccion de todos los protocolos de aplicación existentes.</p>

<p>Si le das click a la segunda versión del enlace mostrado en la parte de arriba desde un nodo que solo soporta IPv6 y tratas de utilizar el NAT64, es obvio que no funcionará, por que el nodo no tiene una pila IPv4 con cual accesar a <code>203.0.113.24</code>.  <code>www.jool.mx</code> funciona bien por que el DNS64 adjunta el frefijo NAT64 una vez que el nodo pregunta por el dominio; por otra parte, si todo lo que el nodo tiene es <code>203.0.113.24</code>, realmente no puede decir que esta hablando mediante un NAT64, mucho menos saber que prefijo deberia ser añadido.</p>

<p><a href="https://tools.ietf.org/html/rfc6877">464XLAT</a> es una técnica orientada a solucionar esta limitante. Funciona agregando un SIIT a la ecuación, que revierte el trabajo hecho por el Stateful NAT64. La idea puede ser generalizada para tambien proveer Internet a servicios que solo soportan IPv4 cuando todo lo que tienes es un espacio de direcciones IPv6, la cual es un <a href="https://tools.ietf.org/html/draft-ietf-v6ops-siit-dc-2xlat-01">Modo de traducción dual SIIT/DC</a></p>

<p>Este documento es un resumen simplificado de ambas técnicas, colapsado en una introducción que usa Jool.</p>

<h2 id="red-de-ejemplo">Red de ejemplo</h2>

<p><img src="../images/network/464-needed.svg" alt="Figure 1 - 464 Needed" /></p>

<p>La caja roja seria tu dominio. <em>n6</em> respresenta un “nodo IPv6” y <em>R</em> es un “router”. Digamos que tu proveedor de internet solo te proporciona direcciones IPv6, pero tambien te garantiza acceso a IPv4 mediante un stateful NAT64(<em>PLAT</em>; Traductor del lado del proveedor o “Provider-side Translator” por sus siglas en inglés). <em>n4</em> nodo de Internet IPv4 aleatorio.</p>

<p>Digamos que tu usuario de <em>n6</em> hace click a un enlace hacia <code>203.0.113.24</code>. <em>n6</em> no tiene una pila IPv4, asi que la solicitud no tiene a donde ir. La situación puede ser enmendada agregando el prefijo NAT64 a la direccion, pero el usuario no lo sabe. Por supuesto, un DNS64 seria la solución ideal y transparente, pero desafortunadamente el sitio proporcionó una dirección y no un nombre de dominio, asi que <em>n6</em> no le esta enviando ninguna solicitud al DNS.</p>

<p>Alternativamente, <em>n6</em> quizá quiera proveer un servicio legado(o cliente) el cual esta desafortunadamente ligado a IPv4. Ya que <em>n6</em> solo tiene direcciones IPv6 globales, aparentemente no puede hacerlo.</p>

<p>En terminos amplios, la solución es proporcionar a <em>n6</em> una pila IPv4 “falsa” cuyos paquetes serán traducidos a IPv6 antes de llegar al <em>PLAT</em>. En
otras palabras, un servicio SIIT (en terminos 464XLAT llamado “<em>CLAT</em>”; Traductod del lado del cliente o “Customer-side Translator” por sus siglas en inglés) estará, de cierta forma, deshaciendo el trabajo del <em>PLAT</em>.</p>

<p>Hay muchas maneras de hacer esto. Desafortunadamente, una de ellas (<a href="https://tools.ietf.org/html/draft-ietf-v6ops-siit-dc-2xlat-01#section-3.1">volver <em>n6</em> el CLAT</a>) todavia no se encuentra implementada en Jool. Una que funcion es hacer que <em>R</em> sea el CLAT. La red luciría como esto:</p>

<p><img src="../images/network/464-network.svg" alt="Figure 2 - 464XLAT'd Network" /></p>

<p>Tambien removi las nubes para simplificar el ruteo en el ejemplo. La idea de la traduccion realmente no tiene nada que ver con el ruteo, asi que esto no es importante.</p>

<h2 id="flujo-de-paquetes-esperado">Flujo de paquetes esperado</h2>

<p>Este es el flujo normal que un paquete de origen IPv6 atravesaría. Es un flujo sateful NAT64 típico y la traducción dual presentada en esta configuración no interferirá con el: Toma en curnta que hemos elejido 64:ff9b::/96 como prefijo NAT64 del <em>PLAT</em>:</p>

<p><img src="../images/flow/464-normal-es.svg" alt="Figure 3 - Normal Stateful Flow" /></p>

<p>El flujo 464XLAT que queremos lograr es el siguiente. <em>n6</em> utilizará su dirección IPv4 para intentar consultar el valor literal (o cualquier dirección de internet IPv4):</p>

<p><img src="../images/flow/464-literal-es.svg" alt="Figure 4 - Literal" /></p>

<p><em>R</em></p>

<p><em>R</em> will SIIT the packet into IPv6 so it can traverse the IPv6-only chunk. Address 192.168.0.8 will be translated using the EAMT, and 203.0.113.24 will receive the <code>pool6</code> prefix treatment to mirror <em>PLAT</em>’s.</p>

<p><img src="../images/flow/464-sless-es.svg" alt="Figure 5 - SIIT'd packet" /></p>

<p><em>PLAT</em> hará su magia y mandará el paquete a la internet IPv4:</p>

<p><img src="../images/flow/464-sful-es.svg" alt="Figure 6 - Stateful NAT64'd packet" /></p>

<p>Y la modificación será espejeada para la respuesta:</p>

<p><img src="../images/flow/464-mirror-es.svg" alt="Figure 7 - Mirror" /></p>

<h2 id="configuracin">Configuración</h2>

<p><em>n6</em> no sabe que de alguna forma es dueño de otra dirección IPv6 en la red 2001:db8:2::/96. Nunca ve el trafico,  por que <em>R</em> siempre siempre lo traduce hacia 192.0.2.0/24.</p>

<pre><code>service network-manager stop

ip link set eth0 up
ip addr add 2001:db8:1::8/64 dev eth0
ip addr add 192.168.0.8/24 dev eth0

ip route add default via 2001:db8:1::1
ip route add default via 192.168.0.1
</code></pre>

<p>Esto es <em>R</em>:</p>

<pre><code>service network-manager stop

ip link set eth0 up
ip addr add 192.168.0.1/24 dev eth0
ip addr add 2001:db8:1::1/64 dev eth0

ip link set eth1 up
ip addr add 2001:db8:100::1/64 dev eth1

# Traffic headed to the real IPv4 Internet goes via PLAT.
ip route add 64:ff9b::/96 via 2001:db8:100::2

# Enable routerness.
sysctl -w net.ipv6.conf.all.forwarding=1
sysctl -w net.ipv4.conf.all.forwarding=1

# Enable SIIT.
# We're masking the private network using an EAMT entry.
# Traffic towards the Internet is to be appended PLAT's prefix.
# Recall that the EAMT has higher precedence than the prefix.
modprobe jool_siit pool6=64:ff9b::/96
jool_siit --eamt --add 192.168.0.8/29 2001:db8:2::/125
</code></pre>

<p>El paquete de <em>n6</em> tendra la dirección <code>192.168.0.8</code> y <code>203.0.113.24</code>. La primera será traducida utilizando el registro EAMT ( ya que coincide con <code>192.168.0.8/29</code>) y la segunda utilizará el prefijo <code>pool6</code> (por que no coincide).</p>

<p>Tambien toma en cuenta que <em>R</em> es una implementacion aproximada de SIIT y jamas se debe de pensar en esta instalación de Jool como nada mas que eso.</p>

<p>Para efectos de ilustrar completamente, mostramos la configuracion de red de <em>PLAT</em>:</p>

<pre><code>service network-manager stop

ip link set eth0 up
ip addr add 2001:db8:100::2/64 dev eth0
# I'm pretending the ISP gave us these two prefixes to play with.
ip route add 2001:db8:1::/64 via 2001:db8:100::1
ip route add 2001:db8:2::/64 via 2001:db8:100::1

ip link set eth1 up
ip addr add 203.0.113.1/24 dev eth1
ip addr add 203.0.113.2/24 dev eth1

modprobe jool pool6=64:ff9b::/96 pool4=203.0.113.2
</code></pre>

<p>Y <em>n4</em> es profundamente aburrido:</p>

<pre><code>service network-manager stop

ip link set eth0 up
ip addr add 203.0.113.24/24 dev eth0
ip route add default via 203.0.113.2
</code></pre>

<h2 id="pruebas">Pruebas</h2>

<p>Haz un ping a <em>n4</em> mediante IPv4 desde <em>n6</em>:</p>

<pre><code>$ ping 203.0.113.24 -c 1
PING 203.0.113.24 (203.0.113.24) 56(84) bytes of data.
64 bytes from 203.0.113.24: icmp_seq=1 ttl=62 time=4.13 ms

--- 203.0.113.24 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 4.130/4.130/4.130/0.000 ms
</code></pre>

<ul>
  <li><a href="obj/464xlat/ipv4-n6.pcapng">ipv4-n6.pcapng</a></li>
  <li><a href="obj/464xlat/ipv4-r.pcapng">ipv4-r.pcapng</a></li>
  <li><a href="obj/464xlat/ipv4-plat.pcapng">ipv4-plat.pcapng</a></li>
  <li><a href="obj/464xlat/ipv4-n4.pcapng">ipv4-n4.pcapng</a></li>
</ul>

<p>HAz un ping a <em>n4</em> mediante IPv6 desde <em>n6</em>:</p>

<pre><code>$ ping6 64:ff9b::203.0.113.24 -c 1
PING 64:ff9b::203.0.113.24(64:ff9b::cb00:7118) 56 data bytes
64 bytes from 64:ff9b::cb00:7118: icmp_seq=1 ttl=62 time=14.0 ms

--- 64:ff9b::203.0.113.24 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 14.053/14.053/14.053/0.000 ms
</code></pre>

<ul>
  <li><a href="obj/464xlat/ipv6-n6.pcapng">ipv6-n6.pcapng</a></li>
  <li><a href="obj/464xlat/ipv6-r.pcapng">ipv6-r.pcapng</a></li>
  <li><a href="obj/464xlat/ipv6-plat.pcapng">ipv6-plat.pcapng</a></li>
  <li><a href="obj/464xlat/ipv6-n4.pcapng">ipv6-n4.pcapng</a></li>
</ul>

<h2 id="palabras-de-cierre">Palabras de cierre</h2>

<p>Aunque en este punto puedes ver como puedes defenderte de los valores IP literales y applicaciones legadas que solo soportan IPv4, quizá quieras ser advertido previamente de que al menos un <a href="http://tools.ietf.org/html/rfc959">protocolo de aplicación</a> allá afuera esta tan pobremente diseñado que trabaja diferente dependiendo de si esta trabajando sobre IPv6 o IPv4. Como resultado, []</p>

<p>Though at this point you can see how you can defend yourself against IP literals and legacy IPv4-only appliances, you might want to be forewarned that at least <a href="http://tools.ietf.org/html/rfc959">one application protocol</a> out there is so poorly designed it works differently depending on whether it’s sitting on top of IPv6 or IPv4. Therefore, <a href="https://github.com/NICMx/NAT64/issues/114">addressing IP literals in this case is not sufficient to make FTP work via NAT64</a>.</p>

<p>Por otra parte, algunos protocolos solo dependen parcialmente de valores literales, y el NAT64 no va a entrometerse en el camino de los que no. El modo pasivo de FTP cae en esta categoria.</p>

<p>On the other hand, some network-aware protocols only partially depend on literals, and the NAT64 is not going to get in the way of the features that don’t. FTP’s passive mode falls in this category.</p>

<p>You can make active FTP work by deploying a fully stateless dual translation environment such as <a href="https://tools.ietf.org/html/draft-ietf-v6ops-siit-dc-2xlat-01">siit-dc-2xlat</a>. It works because both the client and server are both using IPv4 sockets, the IPv4 addresses are unchanged end-to-end, and it’s fully bi-directional, so active and passive FTP on arbitrary ports work fine. In siit-dc-2xlat, the IPv6 network in the middle becomes an invisible “tunnel” through which IPv4 is transported.</p>

<p>Here’s a list of protocols that are known to use IP literals. You might also want to see <a href="http://tools.ietf.org/html/rfc6586">RFC 6586</a>.</p>

<ul>
  <li>FTP</li>
  <li>Skype</li>
  <li>NFS</li>
  <li>Google Talk Client</li>
  <li>AIM (AOL)</li>
  <li>ICQ (AOL)</li>
  <li>MSN</li>
  <li>Webex</li>
  <li><a href="http://tools.ietf.org/html/rfc6586#section-5.4">Some games</a></li>
  <li><a href="http://tools.ietf.org/html/rfc6586#section-5.5">Spotify</a></li>
  <li><a href="http://tools.ietf.org/html/rfc6586#section-6.1">Poorly coded HTML</a></li>
</ul>

<h2 id="lecturas-adicionales">Lecturas adicionales</h2>

<ul>
  <li><a href="https://tools.ietf.org/html/rfc6877">464XLAT</a></li>
  <li><a href="https://tools.ietf.org/html/draft-ietf-v6ops-siit-dc-2xlat-01">SIIT/DC: Dual Translation Mode</a></li>
</ul>


					</div>
				</div>
			</div>
			<div id="language_selector">
				
					<a href="../en/mod-run-464xlat.html">en</a>
				
				|
				
					<span class="selected">es</span>
				
			</div>
			<div style="clear: both;">&nbsp;</div>
		</div>
	</div>

	<div id="footer">
		<div class="logo-tec"><a href="http://www.itesm.mx"><img src="../images/logo-tec.png" alt="logo-tec" /></a></div>
		<div class="logo-nic"><a href="http://www.nicmexico.mx/"><img src="../images/logo-nic.png" alt="logo-nic" /></a></div>
		<p class="legal">&copy;Jool 2015</p>
	</div>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-44741331-2', 'jool.mx');
	  ga('send', 'pageview');

	</script>
</body>
</html>
