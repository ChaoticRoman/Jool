<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>SIIT - Ejemplo básico</title>
	<link href="../css/style.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
</head>

<body>
	<div id="page">
		<div id="contentwrapper">
			<div id="sidebar_navigation" class="sidebar">
				<div class="left_sidebar_menu">
					<div class="left_sidebar_menu_button">
						<a href="index.html">Inicio</a>
					</div>
					<div class="left_sidebar_menu_selected">
						<a href="documentation.html">Documentación</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="download.html">Descargar</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="faq.html">FAQ</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="https://github.com/NICMx/NAT64/issues" target="_blank">
							Reportar un Bug
						</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="about.html">Acerca de ...</a>
					</div>
					<div class="left_sidebar_menu_button">
						<a href="contact.html">Contacto</a>
					</div>
				</div>
			</div>
			<div id="content">
				<div class="worklogo">
					<a href="index.html"><img src="../images/jool.png" alt="logo-jool" /></a>
				</div>
				<div class="workarea">
					<div class="content_text">

<p><a href="documentation.html">Documentación</a> &gt; <a href="documentation.html#ejemplos-de-uso">Ejemplos de uso</a> &gt; SIIT</p>

<h1 id="siit-ejemplo-de-uso">SIIT: Ejemplo de Uso</h1>

<h2 id="ndice">Índice</h2>

<ol>
  <li><a href="#introduccin">Introducción</a></li>
  <li><a href="#red-de-ejemplo">Red de ejemplo</a><br />
 a) <a href="#configuracin-de-nodos-en-ipv6">Configuración de Nodos en IPv6</a><br />
 b) <a href="#configuracin-de-nodos-en-ipv4">Configuración de Nodos en IPv4</a><br />
 c) <a href="#configuracin-del-nodo-traductor">Configuración del Nodo Traductor</a></li>
  <li><a href="#jool">Jool</a></li>
  <li><a href="#pruebas">Pruebas</a><br />
 a) <a href="#conectividad-de-ipv4-a-ipv6">Conectividad de IPv4 a IPv6</a><br />
 b) <a href="#conectividad-de-ipv6-a-ipv4">Conectividad de IPv6 a IPv4</a><br />
 c) <a href="#conectividad-a-un-web-server-en-ipv4">Conectividad a un Web Server en IPv4</a><br />
 d) <a href="#conectividad-a-un-web-server-en-ipv6">Conectividad a un Web Server en IPv6</a></li>
  <li><a href="#deteniendo-jool">Deteniendo Jool</a></li>
  <li><a href="#lecturas-adicionales">Lecturas adicionales</a></li>
</ol>

<h2 id="introduccin">Introducción</h2>

<p>Este documento explica cómo ejecutar Jool en modo SIIT. Si no tienes nociones de este tipo de traducción ingresa a <a href="intro-nat64.html#siit-tradicional">SIIT Tradicional</a>.</p>

<p>En cuanto a software, solo se necesita una <a href="mod-install.html">instalación exitosa del Servidor Jool</a>. El configurador queda fuera del alcance de esta página.</p>

<p>Para la implementación de las pruebas, puedes usar alternativamente máquinas virtuales u otro tipo de interfaces, dado que Jool no está ligado al uso exclusivo de interfaces físicas del tipo “<em>ethX</em>”.</p>

<h2 id="red-de-ejemplo">Red de ejemplo</h2>

<p><img src="../images/network/vanilla.svg" alt="Figura 1 - Red de ejemplo Vanilla" title="Figura 1 - Red de ejemplo Vanilla" /></p>

<p>No es necesario que des de alta todos los nodos que se muestran en el diagrama; puedes lograrlo con solo 3 nodos: <em>A</em>, <em>T</em> y <em>V</em>. El resto son muy similares a <em>A</em> y <em>V</em> y son mostrados para propósitos ilustrativos.</p>

<p>Considera que tienes un bloque de direcciones 198.51.100.8/29 para distribuirlo entre tus nodos IPv6.</p>

<p>Jool requiere que <em>T</em> tenga instalado Linux. El resto de los nodos puede tener cualquier otro sistema operativo, siempre y cuando manejen TCP/IP.</p>

<p>Sin embargo para efectos de simplicidad, los ejemplos aquí mencionados asumen que todos los nodos tienen instalado Linux y que todo esta siendo configurado estáticamente usando el bien-conocido comando <code>ip</code>. Y además, todo el tráfico será redirigido por defecto hacia <em>T</em>.</p>

<p>Dependiendo de tu distribución de linux, la forma de cómo deshabilitar el administrador de red puede variar. Esto se requiere, para que tomes control sobre las direcciones y rutas de tus interfaces; de otra forma, los comandos <code>ip</code> pudieran no tener efecto.</p>

<h3 id="configuracin-de-nodos-en-ipv6">Configuración de Nodos en IPv6</h3>

<p>Para los nodos de <em>A</em> a <em>E</em>, ejecuta la siguiente secuencia de comandos con permisos de administrador:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user@A:~# service network-manager stop
user@A:~# ip link <span class="nb">set </span>eth0 up
user@A:~# <span class="c"># Replace &quot;.8&quot; depending on which node you&#39;re on.</span>
user@A:~# ip addr add 2001:db8::198.51.100.8/120 dev eth0
user@A:~# ip route add default via 2001:db8::198.51.100.1</code></pre></div>

<h3 id="configuracin-de-nodos-en-ipv4">Configuración de Nodos en IPv4</h3>

<p>Para los nodos de <em>V</em> a <em>Z</em>, ejecuta la siguiente secuencia de comandos con permisos de administrador:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user@V:~# service network-manager stop
user@V:~# ip link <span class="nb">set </span>eth0 up
user@V:~# <span class="c"># Replace &quot;.16&quot; depending on which node you&#39;re on.</span>
user@V:~# ip addr add 192.0.2.16/24 dev eth0
user@V:~# ip route add default via 192.0.2.1</code></pre></div>

<h3 id="configuracin-del-nodo-traductor">Configuración del Nodo Traductor</h3>

<p>Para el Nodo <em>T</em>, ejecuta la siguiente secuencia de comandos con permisos de administrador:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user@T:~# service network-manager stop
user@T:~# 
user@T:~# ip link <span class="nb">set </span>eth0 up
user@T:~# ip addr add 2001:db8::198.51.100.1/120 dev eth0
user@T:~# 
user@T:~# ip link <span class="nb">set </span>eth1 up
user@T:~# ip addr add 192.0.2.1/24 dev eth1</code></pre></div>

<p>Hasta aquí, no hemos convertido a <em>T</em> en un traductor todavía, pues el servicio está dado de baja; por lo cual, los nodos desde <em>A</em> hasta <em>E</em> no pueden interactuar todavía con los nodos <em>V</em> hasta <em>Z</em>. Pero, quizá quieras asegurarte de que <em>T</em> puede comunicarse con todos los nodos antes de continuar.</p>

<p>La única precaución que debes tener en mente antes de activar Jool (o lidiar con IPv6 en general) son los “offloads”. “Offloading” es una característica de los nodos terminales, y para los que no lo son esto es un problema, por lo cual es importante apagarlos en todos los ruteadores. <a href="offloading.html">Lee este documento</a> si quieres conocer más detalles sobre esta problemática.</p>

<p>Hazlo por medio de <code>ethtool</code>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user@T:~# ethtool --offload eth0 tso off
user@T:~# ethtool --offload eth0 ufo off
user@T:~# ethtool --offload eth0 gso off
user@T:~# ethtool --offload eth0 gro off
user@T:~# ethtool --offload eth0 lro off
user@T:~# ethtool --offload eth1 tso off
user@T:~# ethtool --offload eth1 ufo off
user@T:~# ethtool --offload eth1 gso off
user@T:~# ethtool --offload eth1 gro off
user@T:~# ethtool --offload eth1 lro off</code></pre></div>

<pre><code>NOTA: Si no puedes cambiar alguno de los parámetros, considera que es posible que ya este apagado.
	     Ejecuta `sudo ethtool --show-offload [interface]` para averiguarlo.
</code></pre>

<h2 id="jool">Jool</h2>

<p>Esta es la sintaxis para insertar Jool SIIT en el kernel:<br />
(Requieres permiso de administración)</p>

<pre><code>user@T:~# modprobe jool_siit \
	[pool6=&lt;IPv6 prefix&gt;] \
	[blacklist=&lt;IPv4 prefixes&gt;] \
	[pool6791=&lt;IPv4 prefixes&gt;] \
	[disabled]
</code></pre>

<p>Los parámetros válidos son:</p>

<ul>
  <li>
    <p><code>pool6</code> (abreviación de “Pool de IPv6”) es el prefijo que el mecanismo de traducción estará adjuntando y removiendo de las direcciones de los paquetes. Este podría ser opcional, porque quizá estas planeando usar EAM.</p>
  </li>
  <li>
    <p><code>blacklist</code> representa direcciones IPv4 que Jool <strong>no</strong> va a traducir usando el prefijo pool6, por lo que esto no afecta en la traducción EAM. Puedes insertar hasta cinco prefijos separados por coma durante un modprobe. Si necesitas más, utiliza la <a href="usr-flags-blacklist.html">Herramienta de Configuración de Jool</a>.</p>
  </li>
  <li>
    <p><code>pool6791</code> es un pool IPv4 secundario que se utiliza cuando <a href="rfc6791.html">no hay una conexión directa entre uno o varios nodos y el traductor</a>. Si este pool está vacío, Jool enviará la dirección propia de su nodo hacia el nodo destino. Puedes insertar hasta cinco prefijos <code>pool6791</code> separados por coma durante un modprobe. Si necesitas más, utiliza la <a href="usr-flags-pool6791.html">Herramienta de Configuración de Jool</a>.</p>
  </li>
  <li>
    <p><code>disabled</code> inicia Jool en modo inactivo. Si estás utilizando el configurador, puedes usar esta opción para asegurarte de que has terminado de configurar antes de que tu tráfico empiece a ser traducido.
Si no está presente, Jool empieza a traducir el tráfico de inmediato.</p>
  </li>
</ul>

<p>Lo siguiente es sufciente para nuestra red de ejemplo.</p>

<pre><code>user@T:~# modprobe jool_siit pool6=2001:db8::/96
</code></pre>

<p>Eso significa que: “La representación IPv6 de cualquier dirección IPv4 va a ser <code>2001:db8::&lt;IPv4 address&gt;</code>.”</p>

<h2 id="pruebas">Pruebas</h2>

<h3 id="conectividad-de-ipv4-a-ipv6">Conectividad de IPv4 a IPv6</h3>

<p>Haz un ping a <em>A</em> desde <em>V</em> de esta forma:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user@V:~<span class="nv">$ </span>ping 198.51.100.8
PING 198.51.100.8 <span class="o">(</span>198.51.100.8<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
<span class="m">64</span> bytes from 198.51.100.8: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>7.45 ms
<span class="m">64</span> bytes from 198.51.100.8: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>1.64 ms
<span class="m">64</span> bytes from 198.51.100.8: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>4.22 ms
<span class="m">64</span> bytes from 198.51.100.8: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">4</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>2.32 ms
^C
--- 198.51.100.8 ping statistics ---
<span class="m">4</span> packets transmitted, <span class="m">4</span> received, 0% packet loss, <span class="nb">time </span>3006ms
rtt min/avg/max/mdev <span class="o">=</span> 1.649/3.914/7.450/2.249 ms</code></pre></div>

<h3 id="conectividad-de-ipv6-a-ipv4">Conectividad de IPv6 a IPv4</h3>

<p>Haz un ping a <em>V</em> desde <em>A</em>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user@A:~<span class="nv">$ </span>ping6 2001:db8::192.0.2.16
PING 2001:db8::192.0.2.16<span class="o">(</span>2001:db8::c000:210<span class="o">)</span> <span class="m">56</span> data bytes
<span class="m">64</span> bytes from 2001:db8::c000:210: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>3.57 ms
<span class="m">64</span> bytes from 2001:db8::c000:210: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>10.5 ms
<span class="m">64</span> bytes from 2001:db8::c000:210: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>1.38 ms
<span class="m">64</span> bytes from 2001:db8::c000:210: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">4</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nb">time</span><span class="o">=</span>2.63 ms
^C
--- 2001:db8::192.0.2.16 ping statistics ---
<span class="m">4</span> packets transmitted, <span class="m">4</span> received, 0% packet loss, <span class="nb">time </span>3003ms
rtt min/avg/max/mdev <span class="o">=</span> 1.384/4.529/10.522/3.546 ms</code></pre></div>

<h3 id="conectividad-a-un-web-server-en-ipv4">Conectividad a un Web Server en IPv4</h3>

<p>Agrega un servidor en <em>X</em> y accesalo desde <em>D</em>:</p>

<p><img src="../images/run-vanilla-firefox-4to6.png" alt="Figura 1 - IPv4 TCP desde un nodo IPv6" /></p>

<h3 id="conectividad-a-un-web-server-en-ipv6">Conectividad a un Web Server en IPv6</h3>

<p>Agrega un servidor en <em>C</em> y haz una solicitud desde <em>W</em>:</p>

<p><img src="../images/run-vanilla-firefox-6to4.png" alt="Figure 2 - IPv6 TCP desde un nodo IPv4" /></p>

<p>Si algo no funciona, consulta el <a href="faq.html">FAQ</a>.</p>

<h2 id="deteniendo-jool">Deteniendo Jool</h2>

<p>Para detener Jool, emplea de nuevo el comando modprobe usando el parámetro <code>-r</code>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">user@T:~# modprobe -r jool_siit</code></pre></div>

<h2 id="lecturas-adicionales">Lecturas adicionales</h2>

<p>Si quieres profundizar te recomedamos leer:</p>

<ol>
  <li>El <a href="usr-flags-pool6791.html">argumento <code>pool6791</code></a> y su <a href="rfc6791.html">uso</a>.</li>
  <li>Por favor, lee acerca de <a href="mtu.html">problemas con MTUs</a> antes de seleccionar alguno.</li>
  <li>Si te interesa EAM, dirigete al <a href="mod-run-eam.html">segundo ejemplo</a>.</li>
  <li>Si te interesa Stateful NAT64, dirigete al <a href="mod-run-stateful.html">tercer ejemplo</a>.</li>
  <li>El <a href="dns64.html">documento de DNS64</a> te dirá como configurar un DNS64 para hacer transparente el uso de dirección-prefijo a los usuarios.</li>
</ol>


					</div>
				</div>
			</div>
			<div id="language_selector">
				
					<a href="../en/mod-run-vanilla.html">en</a>
				
				|
				
					<span class="selected">es</span>
				
			</div>
			<div style="clear: both;">&nbsp;</div>
		</div>
	</div>

	<div id="footer">
		<div class="logo-tec"><a href="http://www.itesm.mx"><img src="../images/logo-tec.png" alt="logo-tec" /></a></div>
		<div class="logo-nic"><a href="http://www.nicmexico.mx/"><img src="../images/logo-nic.png" alt="logo-nic" /></a></div>
		<p class="legal">&copy;Jool 2015</p>
	</div>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-44741331-2', 'jool.mx');
	  ga('send', 'pageview');

	</script>
</body>
</html>
